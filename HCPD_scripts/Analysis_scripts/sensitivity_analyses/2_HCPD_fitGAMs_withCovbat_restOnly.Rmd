---
title: "HCPD fit GAMs"
author: "Audrey Luo"
output: html_document
---

```{r setup, include=FALSE}

library(dplyr)
source("/cbica/projects/network_replication/Rscripts/functions/main_analyses/GAM_functions.R") # same functions as used for main analysis
source("/cbica/projects/network_replication/Rscripts/functions/sensitivity_analyses/fitGAMs_restOnly.R") 
 
dataset = "HCPD"
  
```

 
# make connectivityMetric-demographics .csv's
```{r connMetric_demographics, include=FALSE}

demographics <- read.csv("/cbica/projects/network_replication/input/HCPD/sample_selection/HCPD_demographics_finalsample_restOnly_20230103.csv")
demographics <- demographics %>% rename(subject=sub) 
demographics$age <- demographics$interview_age/12
demographics <- demographics[,c(which(names(demographics) == "subject"), which(names(demographics) == "sex"), which(names(demographics)=="age"), which(names(demographics) =="meanFD_avgSes"))] 

## creates GBC.schaefer200.HCPD 
GBC.schaefer200.HCPD <- make_connMetricsDemog_covbat("schaefer200", "GBC", demographics, "subject", dataset)
 
 
 
```


 

# load connectivityMetric-demographics .csv's
```{r load_connectivity, include=TRUE}  
GBC.schaefer200.HCPD <- read.csv(sprintf("/cbica/projects/network_replication/output/%1$s/sensitivity_analyses/GBC/GBCschaefer200_demographics_finalsample_covbat.csv", dataset)) 
names(GBC.schaefer200.HCPD) <- gsub('X17Networks', "Networks", names(GBC.schaefer200.HCPD))
 
GBC.schaefer200.HCPD$sex <- as.factor(GBC.schaefer200.HCPD$sex)
 
 
```

 
# load parcel labels 
```{r}
# load parcel labels 
schaefer200x17.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200x17_regionlist_final.csv")
```  


# Fit GAMs
```{r}
# GBC GAMs
gam.GBC.age.schaefer200 <- fitGAMs_covbat(schaefer200x17.parcel.labels, "GBC", "schaefer200", "", dataset)
```




# Estimate GAM smooths based on model-predicted data and save out predicted y data** 
```{r}
# GBC GAMs 
gam.GBC.smooths.schaefer200 <- estimate_GAMsmooths_covbat(schaefer200x17.parcel.labels, "GBC", "schaefer200", "", dataset)
```


 
