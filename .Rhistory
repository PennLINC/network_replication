source("./3_GAM_functions.R")
source("/cbica/projects/network_replication/adapted_Rscripts/GAM_functions.R")
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
#source("./3_GAM_functions.R")
source("/cbica/projects/network_replication/adapted_Rscripts/GAM_functions.R")
participants <- read.csv("participants_allIDs.csv") #final study sample pnc IDs (bblid/scanid) from Adam Pines's multiscale paper
demographics <- read.csv("/cbica/projects/network_replication/PNC/n1601_demographics_go1_20161212.csv") #PNC demographics information
demographics <- demographics %>% mutate(age = (ageAtScan1/12)) #format age variable
demographics$sex <- as.factor(demographics$sex) #format sex variable
demographics <- merge(participants, demographics, by="scanid") #get demographics for final study sample only via ID matching
relRMS <- read.csv("/cbica/projects/network_replication/PNC/qc_files/RBC_PNC_relMeans.csv")
demographics <- merge(demographics, relRMS, by="rbcid") #add motion information to demographics df
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
require(ggplot2)
library(cowplot)
library(cifti)
library(ggseg)
Sys.setenv(RGL_USE_NULL=TRUE)
library(ggsegExtra)
library(ggsegSchaefer)
library(ggcorrplot)
library(viridis)
library(scales)
library(stringr)
library(tidyr)
# load SNR mask
SNRmask_schaefer200 <- read.csv('/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer200x17.csv')
# load region list
schaefer200.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200x17_regionlist.csv", header = T)
names(schaefer200.parcel.labels) <- c("orig_parcelname", "label")
schaefer200.parcel.labels[which(SNRmask_schaefer200 == 0),] <- NA # apply SNR mask to parcel names
schaefer200.parcel.labels <- na.omit(schaefer200.parcel.labels)
# load parcellated SA axis
schaefer200_SAaxis_cifti <- read_cifti("/cbica/projects/network_replication/SAaxis/SensorimotorAssociation_Axis_parcellated/SensorimotorAssociation.Axis.Schaefer200.17Networks.pscalar.nii")
schaefer200_SAaxis <- as.data.frame(cbind(rank(schaefer200_SAaxis_cifti$data), names(schaefer200_SAaxis_cifti$Parcel)))
colnames(schaefer200_SAaxis) <- c("SA.axis_rank","label")
# apply SNR mask
schaefer200_SAaxis[which(SNRmask_schaefer200 == 0),] <- NA
schaefer200_SAaxis <- na.omit(schaefer200_SAaxis)
gam.gbc.age.schaefer200 <- read.csv("/cbica/projects/network_replication/GBC/GAM/GAMresults.GBC.age.schaefer200x17.csv")
gam.gbc.age.schaefer200 <- gam.gbc.age.schaefer200 %>% select(-label)
gam.gbc.age.schaefer200$label <- schaefer200_SAaxis$label
df.list <- list(schaefer200_SAaxis,gam.gbc.age.schaefer200)
gbc.axis <- Reduce(function(x,y) merge(x,y, all=TRUE, sort=F), df.list)
gbc.axis$SA.axis_rank <- as.numeric(gbc.axis$SA.axis_rank)
gbc.axis
attach(gbc.axis)
gbc.axis[order(SA.axis_rank),]
gbc.axis[order(SA.axis_rank),1]
library(cifti)
#BNC - loads gam.BNC.age.gordon, gam.BNC.age.schaefer200x7, gam.BNC.age.schaefer400x7, gam.BNC.age.schaefer200x17, gam.BNC.age.schaefer400x17
metric = "BNC"
for(i in c(1:length(atlases))){
df_name <- paste0("gam.", metric, ".", "age.", atlases[i])
assign(df_name, read.csv(sprintf("/cbica/projects/network_replication/output/%1$s/%2$s/GAM/GAMresults.%2$s.age.%3$s.csv", dataset, metric, atlases[i])))
assign(df_name, get(df_name) %>% select(-label))
SAaxis <- get(paste0(atlases[i], "_", "SAaxis"))
df_to.label <- get(df_name)
df_to.label$label <- SAaxis$label
assign(df_name, df_to.label)
}
library(cifti)
#BNC - loads gam.BNC.age.gordon, gam.BNC.age.schaefer200x7, gam.BNC.age.schaefer400x7, gam.BNC.age.schaefer200x17, gam.BNC.age.schaefer400x17
atlases_GBC <- c("glasser", "gordon", "schaefer200", "schaefer400")
atlases <- c("gordon", "schaefer200x7", "schaefer200x17", "schaefer400x7", "schaefer400x17")
dataset <- "NKI"
metric = "BNC"
for(i in c(1:length(atlases))){
df_name <- paste0("gam.", metric, ".", "age.", atlases[i])
assign(df_name, read.csv(sprintf("/cbica/projects/network_replication/output/%1$s/%2$s/GAM/GAMresults.%2$s.age.%3$s.csv", dataset, metric, atlases[i])))
assign(df_name, get(df_name) %>% select(-label))
SAaxis <- get(paste0(atlases[i], "_", "SAaxis"))
df_to.label <- get(df_name)
df_to.label$label <- SAaxis$label
assign(df_name, df_to.label)
}
library(cifti)
library(dplyr)
require(ggplot2)
library(cowplot)
library(ggseg)
Sys.setenv(RGL_USE_NULL=TRUE)
library(ggsegExtra)
library(ggsegSchaefer)
library(ggsegGlasser)
library(ggsegGordon)
library(ggcorrplot)
library(viridis)
library(scales)
library(stringr)
library(tidyr)
library(ggpubr)
library(purrr)
library(pammtools)
atlases_GBC <- c("glasser", "gordon", "schaefer200", "schaefer400")
atlases <- c("gordon", "schaefer200x7", "schaefer200x17", "schaefer400x7", "schaefer400x17")
dataset <- "NKI"
metric = "BNC"
for(i in c(1:length(atlases))){
df_name <- paste0("gam.", metric, ".", "age.", atlases[i])
assign(df_name, read.csv(sprintf("/cbica/projects/network_replication/output/%1$s/%2$s/GAM/GAMresults.%2$s.age.%3$s.csv", dataset, metric, atlases[i])))
assign(df_name, get(df_name) %>% select(-label))
SAaxis <- get(paste0(atlases[i], "_", "SAaxis"))
df_to.label <- get(df_name)
df_to.label$label <- SAaxis$label
assign(df_name, df_to.label)
}
glasser_SAaxis <- read.csv("/cbica/projects/network_replication/SAaxis/glasser_SAaxis.csv")
gordon_SAaxis <- read.csv("/cbica/projects/network_replication/SAaxis/gordon_SAaxis.csv")
schaefer200x7_SAaxis <- read.csv("/cbica/projects/network_replication/SAaxis/schaefer200x7_SAaxis.csv")
schaefer200x7_SAaxis$label <- gsub("7Network", "Network", schaefer200x7_SAaxis$label)
schaefer200x17_SAaxis <- read.csv("/cbica/projects/network_replication/SAaxis/schaefer200x17_SAaxis.csv")
schaefer200x17_SAaxis$label <- gsub("17Network", "Network", schaefer200x17_SAaxis$label)
schaefer200_SAaxis <- schaefer200x17_SAaxis
schaefer400x7_SAaxis  <- read.csv("/cbica/projects/network_replication/SAaxis/schaefer400x7_SAaxis.csv")
schaefer400x7_SAaxis$label <-  gsub("7Networks", "Networks", schaefer400x7_SAaxis$label)
schaefer400x17_SAaxis <- read.csv("/cbica/projects/network_replication/SAaxis/schaefer400x17_SAaxis.csv")
schaefer400x17_SAaxis$label <- gsub("17Network", "Network", schaefer400x17_SAaxis$label)
schaefer400_SAaxis <- schaefer400x17_SAaxis
#BNC - loads gam.BNC.age.gordon, gam.BNC.age.schaefer200x7, gam.BNC.age.schaefer400x7, gam.BNC.age.schaefer200x17, gam.BNC.age.schaefer400x17
atlases_GBC <- c("glasser", "gordon", "schaefer200", "schaefer400")
atlases <- c("gordon", "schaefer200x7", "schaefer200x17", "schaefer400x7", "schaefer400x17")
dataset <- "NKI"
metric = "BNC"
for(i in c(1:length(atlases))){
df_name <- paste0("gam.", metric, ".", "age.", atlases[i])
assign(df_name, read.csv(sprintf("/cbica/projects/network_replication/output/%1$s/%2$s/GAM/GAMresults.%2$s.age.%3$s.csv", dataset, metric, atlases[i])))
assign(df_name, get(df_name) %>% select(-label))
SAaxis <- get(paste0(atlases[i], "_", "SAaxis"))
df_to.label <- get(df_name)
df_to.label$label <- SAaxis$label
assign(df_name, df_to.label)
}
schaefer400x7_coords <- read.csv("/cbica/projects/network_replication/software/rotate_parcellation/Schaefer2018_400Parcels_7Networks_order_FSLMNI152_1mm.Centroid_RAS.csv", header=TRUE)
A00018030_cifti <- read_cifti("/cbica/projects/network_replication/input/NKI/nki_xcp/sub-A00018030/sub-A00018030_ses-BAS1_task-rest_acq-645_space-fsLR_atlas-Schaefer417_den-91k_bold.ptseries.nii")
schaefer400x7_ggseg <- ggsegSchaefer::schaefer7_400$data$region[-c(which(is.na(ggsegSchaefer::schaefer7_400$data$region)))]
schaefer400x7_ggseg_noDups <- schaefer400x7_ggseg[-c(which(duplicated(schaefer400x7_ggseg)))]
setdiff(schaefer400x7_ggseg_noDups, schaefer400x7_coords$ROI.Name)
setdiff(schaefer400x7_coords$ROI.Name, schaefer400x7_ggseg_noDups)
schaefer400x7_coords$ROI.Name
schaefer400x7_ggseg_noDups
schaefer400x7_ggseg_noDups[match(schaefer400x7_coords$ROI.Name, schaefer400x7_ggseg_noDups)]
schaefer400x7_ggseg_noDups_matched <- schaefer400x7_ggseg_noDups[match(schaefer400x7_coords$ROI.Name, schaefer400x7_ggseg_noDups)]
identical(schaefer400x7_ggseg_noDups_matched, schaefer400x7_coords$ROI.Name)
length(schaefer400x7_ggseg_noDups_matched)
duplicated(schaefer400x7_ggseg_noDups_matched)
which(duplicated(schaefer400x7_ggseg_noDups_matched))
schaefer200x7_coords <- read.csv("/cbica/projects/network_replication/software/rotate_parcellation/Schaefer2018_200Parcels_7Networks_order_FSLMNI152_1mm.Centroid_RAS.csv", header=TRUE)
A00018030_cifti <- read_cifti("/cbica/projects/network_replication/input/NKI/nki_xcp/sub-A00018030/sub-A00018030_ses-BAS1_task-rest_acq-645_space-fsLR_atlas-Schaefer217_den-91k_bold.ptseries.nii")
schaefer200x7_ggseg <- ggsegSchaefer::schaefer7_200$data$region[-c(which(is.na(ggsegSchaefer::schaefer7_200$data$region)))]
schaefer200x7_ggseg_noDups <- schaefer200x7_ggseg[-c(which(duplicated(schaefer200x7_ggseg)))]
setdiff(schaefer200x7_ggseg_noDups, schaefer200x7_coords$ROI.Name)
setdiff(schaefer200x7_coords$ROI.Name, schaefer200x7_ggseg_noDups)
schaefer200x7_ggseg_noDups_matched <- schaefer200x7_ggseg_noDups[match(schaefer200x7_coords$ROI.Name, schaefer200x7_ggseg_noDups)]
identical(schaefer200x7_ggseg_noDups_matched, schaefer200x7_coords$ROI.Name)
schaefer200x7_coords$ROI.Name
schaefer200x7_ggseg_noDups
names(A00018030_cifti$Parcel)
# reorder parcel labels
schaefer200x7.parcel.labels <- read.csv("/cbica/projects/network_replication/software/rotate_parcellation/Schaefer2018_200Parcels_7Networks_order_FSLMNI152_1mm.Centroid_RAS.csv", header=TRUE)
schaefer200x7.parcel.labels$ROI.Label
schaefer200x7.parcel.labels$ROI.Name
schaefer200x7.parcel.labels <- schaefer200x7.parcel.labels$ROI.Name
schaefer200x7.parcel.labels
schaefer200x7.parcel.labels <- read.csv("/cbica/projects/network_replication/software/rotate_parcellation/Schaefer2018_200Parcels_7Networks_order_FSLMNI152_1mm.Centroid_RAS.csv", header=TRUE)
schaefer200x7.parcel.labels <- data.frame(schaefer200x7.parcel.labels$ROI.Name)
schaefer200x7.parcel.labels
names(schaefer200x7.parcel.labels) <- "region"
schaefer200x7.parcel.labels
write.csv(schaefer200x7.parcel.labels, "/cbica/projects/network_replication/atlases/parcellations/schaefer200_7Network_regionlist.csv")
schaefer200x17.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200x17_regionlist.csv", header = T)
# want to put schaefer200x7 in the same order as schaefer200x17
index_schaefer200x7to17 <- read.csv("/cbica/projects/network_replication/software/schaefer7to17_reordering/index_schaefer200x7to17.csv", header=F)
index_schaefer200x7to17$V1 <- as.numeric(index_schaefer200x7to17$V1)
schaefer200x7_reordered <-schaefer200x7.parcel.labels$V1[index_schaefer200x7to17$V1]
as.matrix(cbind(schaefer200x7_reordered, schaefer200x17.parcel.labels))
schaefer200x7_reordered
index_schaefer200x7to17
index_schaefer200x7to17$V1 <- as.numeric(index_schaefer200x7to17$V1)
index_schaefer200x7to17
schaefer200x7.parcel.labels
schaefer200x7_reordered <- schaefer200x7.parcel.labels$region[index_schaefer200x7to17$V1]
as.matrix(cbind(schaefer200x7_reordered, schaefer200x17.parcel.labels))
write.csv(schaefer200x7_communityAffil_reordered, "/cbica/projects/network_replication/atlases/parcellations/Schaefer_7Network/schaefer200x7CommunityAffiliation.1D_reordered.csv")
write.csv(schaefer200x7_reordered, "/cbica/projects/network_replication/atlases/parcellations/schaefer200_7Network_regionlist_reordered.csv")
# reorder parcel labels
schaefer400x7.parcel.labels <- read.csv("/cbica/projects/network_replication/software/rotate_parcellation/Schaefer2018_400Parcels_7Networks_order_FSLMNI152_1mm.Centroid_RAS.csv", header=TRUE)
schaefer400x7.parcel.labels <- data.frame(schaefer400x7.parcel.labels$ROI.Name)
names(schaefer400x7.parcel.labels) <- "region"
schaefer400x7.parcel.labels
write.csv(schaefer400x7.parcel.labels, "/cbica/projects/network_replication/atlases/parcellations/schaefer400_7Network_regionlist.csv")
schaefer400x17.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer400x17_regionlist.csv", header = T)
write.csv(schaefer200x7.parcel.labels, "/cbica/projects/network_replication/atlases/parcellations/schaefer200x7_regionlist.csv")
write.csv(schaefer200x7_reordered, "/cbica/projects/network_replication/atlases/parcellations/schaefer200x7_regionlist_reordered.csv")
schaefer400x7.parcel.labels
write.csv(schaefer400x7.parcel.labels, "/cbica/projects/network_replication/atlases/parcellations/schaefer400x7_regionlist.csv")
index_schaefer400x7to17 <- read.csv("/cbica/projects/network_replication/software/schaefer7to17_reordering/index_schaefer400x7to17.csv", header=F)
index_schaefer400x7to17$V1 <- as.numeric(index_schaefer400x7to17$V1)
schaefer400x7_reordered <- schaefer400x7.parcel.labels$region[index_schaefer400x7to17$V1]
as.matrix(cbind(schaefer400x7_reordered, schaefer400x17.parcel.labels))
write.csv(schaefer400x7_reordered, "/cbica/projects/network_replication/atlases/parcellations/schaefer400x7_regionlist_reordered.csv")
library(ciftiTools)
ciftiTools.setOption('wb_path', '/Applications/workbench/')
library(cifti)
library(plyr)
#setwd("/cbica/projects/network_replication/")
schaefer200x7_SAaxis <- read.csv("/cbica/projects/network_replication/SAaxis/schaefer200x7_SAaxis.csv")
schaefer200x7_SAaxis
glasser_SAaxis_cifti <- read_cifti("/cbica/projects/network_replication/SAaxis/SensorimotorAssociation_Axis_parcellated_ciftis/SensorimotorAssociation.Axis.Glasser360.pscalar.nii")
