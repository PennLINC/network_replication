ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=122, y=0.07, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=121, y=0.07, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_S A.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
ggsave(schaefer200_S A.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
ggsave(schaefer200_S A.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=125, y=0.055, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=126, y=0.055, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=128, y=0.055, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=13-, y=0.055, label="R = -0.60, p < 0.00001  ", color="black"))
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=130, y=0.055, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(schaefer200_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=140, y=0.055, label="R = -0.60, p < 0.00001  ", color="black"))
ggsave(schaefer200_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Schaefer200/schaefer200x17_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
# seems like transmodal areas have greater GBC and seem to increase with age, while unimodal areas have smaller GBC and increase or stays the same with age
(schaefer200_predGBC <- ggplot(gam.smooths.schaefer200,aes(age,fit,group=index)) +
geom_line(data = gam.smooths.schaefer200, size=.8, alpha = .6, aes(color=SA.axis_rank)) + scale_color_gradient2(low="#6f1282",high = "goldenrod1", mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank)) +
labs(color = "SA Axis Rank",
x="Age",
y="Predicted Global Brain Connectivity") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "bottom") + coord_cartesian(expand = FALSE, xlim = c(8, 23)))
(schaefer200_agepeak <- ggplot() + geom_brain(data=gam.agepeaks.schaefer200,
atlas=schaefer17_200,
mapping=aes(fill=age.peak),
show.legend=TRUE,
position = position_brain(hemi ~ side)) +
scale_fill_gradientn(colors = viridis_pal(option="B")(10)) + theme_void())
names(gam.agepeaks.schaefer200)[2] <- "region"
(schaefer200_agepeak <- ggplot() + geom_brain(data=gam.agepeaks.schaefer200,
atlas=schaefer17_200,
mapping=aes(fill=age.peak),
show.legend=TRUE,
position = position_brain(hemi ~ side)) +
scale_fill_gradientn(colors = viridis_pal(option="B")(10)) + theme_void())
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
require(ggplot2)
library(cowplot)
library(cifti)
library(ggseg)
Sys.setenv(RGL_USE_NULL=TRUE)
library(ggsegExtra)
library(ggsegGordon)
library(ggcorrplot)
library(viridis)
library(scales)
library(stringr)
library(tidyr)
# load SNR mask
SNRmask_gordon <- read.csv('/cbica/projects/network_replication/atlases/Masks/SNRmask_gordon.csv')
# load region list
gordon.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/gordon_regionlist.csv", header = T)
names(gordon.parcel.labels) <- c("orig_parcelname", "label")
gordon.parcel.labels[which(SNRmask_gordon == 0),] <- NA # apply SNR mask to parcel names
gordon.parcel.labels <- na.omit(gordon.parcel.labels)
# load parcellated SA axis
gordon_SAaxis_cifti <- read_cifti("/Users/audluo/cbica/projects/network_replication/SAaxis/SensorimotorAssociation_Axis_parcellated/SensorimotorAssociation.Axis.Gordon333.pscalar.nii")
gordon_SAaxis <- as.data.frame(cbind(rank(gordon_SAaxis_cifti$data), names(gordon_SAaxis_cifti$Parcel)))
colnames(gordon_SAaxis) <- c("SA.axis_rank","label")
# apply SNR mask
gordon_SAaxis[which(SNRmask_gordon == 0),] <- NA
gordon_SAaxis <- na.omit(gordon_SAaxis)
## GAM Results
gam.gbc.age.gordon <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMresults.GBC.age.gordon.csv")
gam.gbc.age.gordon <- gam.gbc.age.gordon %>% select(-label)
gam.gbc.age.gordon$label <- gordon_SAaxis$label
gam.smooths.gordon <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMsmoothfits.GBC.age.gordon.csv")
gam.smooths.gordon$orig_parcelname <- gam.smooths.gordon$label
gam.agepeaks.gordon <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMpeaks.GBC.age.gordon.csv")
gam.agepeaks.gordon <- gam.agepeaks.gordon %>% select(-label)
gam.agepeaks.gordon$label <- gordon.parcel.labels$label
# Combine into Final Dfs
df.list <- list(gordon_SAaxis,gam.gbc.age.gordon)
gbc.axis <- Reduce(function(x,y) merge(x,y, all=TRUE, sort=F), df.list)
gbc.axis$SA.axis_rank <- as.numeric(gbc.axis$SA.axis_rank)
a <- merge(gordon.parcel.labels, gordon_SAaxis, by="label", sort=F)
gam.smooths.gordon <- left_join(gam.smooths.gordon, a, by = "label")
gam.smooths.gordon$SA.axis_rank <-as.numeric(gam.smooths.gordon$SA.axis_rank)
gam.agepeaks.gordon <- left_join(gam.agepeaks.gordon, gordon_SAaxis, by="label")
gam.agepeaks.gordon$SA.axis_rank <-as.numeric(gam.agepeaks.gordon$SA.axis_rank)
gbc.axis$Anova.age.pvalue.fdr <- p.adjust(gbc.axis$Anova.age.pvalue, method=c("fdr"))
cat(sprintf("There are %s/%s significant parcels", sum(gbc.axis$Anova.age.pvalue.fdr < 0.05), nrow(gbc.axis)))
gbc.axis$significant.fdr <- gbc.axis$Anova.age.pvalue.fdr < 0.05
gbc.axis$significant.fdr[gbc.axis$significant.fdr == TRUE] <- 1
gbc.axis$significant.fdr[gbc.axis$significant.fdr == FALSE] <- 0
cor.test(gbc.axis$GAM.age.AdjRsq, as.numeric(gbc.axis$SA.axis_rank), method=c("spearman"), exact=F)
## SA axis average rank vs. age effect
(gordon_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=120, y=0.07, label="R = -0.66, p = tbd  ", color="black"))
# included all datapoints
gbc.axis <- gbc.axis %>% mutate(SA.axis_rank_signif = ifelse(significant.fdr == 1, SA.axis_rank, NA))
## SA axis average rank vs. age effect
(gordon_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=120, y=0.07, label="R = -0.66, p = tbd  ", color="black"))
## SA axis average rank vs. age effect
(gordon_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=120, y=0.07, label="R = -0.66, p < 0.0001  ", color="black"))
ggsave(gordon_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/gordon_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
(gordon_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=120, y=0.07, label="R = -0.66, p < 0.0001  ", color="black"))
ggsave(gordon_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/gordon_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
ggsave(gordon_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Gordon333/gordon_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
# seems like transmodal areas have greater GBC and seem to increase with age, while unimodal areas have smaller GBC and increase or stays the same with age
(gordon_predGBC <- ggplot(gam.smooths.gordon,aes(age,fit,group=index)) +
geom_line(data = gam.smooths.gordon, size=.8, alpha = .6, aes(color=SA.axis_rank)) + scale_color_gradient2(low="#6f1282",high = "goldenrod1", mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank)) +
labs(color = "SA Axis Rank",
x="Age",
y="Predicted Global Brain Connectivity") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "bottom") + coord_cartesian(expand = FALSE, xlim = c(8, 23)))
names(gam.agepeaks.gordon)[2] <- "region"
(gordon_agepeak <- ggplot() + geom_brain(data=gam.agepeaks.gordon,
atlas=gordon,
mapping=aes(fill=age.peak),
show.legend=TRUE,
position = position_brain(hemi ~ side)) +
scale_fill_gradientn(colors = viridis_pal(option="B")(10)) + theme_void())
#ggsave(gordon_agepeak, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Gordon333/gordon_agepeak.pdf", width = 6, height=4, dpi=300)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
require(ggplot2)
library(cowplot)
library(cifti)
library(ggseg)
Sys.setenv(RGL_USE_NULL=TRUE)
library(ggsegExtra)
library(ggsegGlasser)
library(ggcorrplot)
library(viridis)
library(scales)
library(stringr)
library(tidyr)
# load SNR mask
SNRmask_glasser <- read.csv('/cbica/projects/network_replication/atlases/Masks/SNRmask_glasser360.csv')
# load region list
glasser.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/glasser360_regionlist.csv", header = T)
names(glasser.parcel.labels) <- c("orig_parcelname", "label")
glasser.parcel.labels[which(SNRmask_glasser == 0),] <- NA # apply SNR mask to parcel names
glasser.parcel.labels <- na.omit(glasser.parcel.labels)
# load parcellated SA axis
glasser_SAaxis_cifti <- read_cifti("/cbica/projects/network_replication/SAaxis/SensorimotorAssociation_Axis_parcellated/SensorimotorAssociation.Axis.Glasser360.pscalar.nii")
glasser_SAaxis <- as.data.frame(cbind(rank(glasser_SAaxis_cifti$data), names(glasser_SAaxis_cifti$Parcel)))
colnames(glasser_SAaxis) <- c("SA.axis_rank","label")
# apply SNR mask
glasser_SAaxis[which(SNRmask_glasser == 0),] <- NA
glasser_SAaxis <- na.omit(glasser_SAaxis)
## GAM Results
gam.gbc.age.glasser <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMresults.GBC.age.glasser.csv")
gam.gbc.age.glasser <- gam.gbc.age.glasser %>% select(-label)
gam.gbc.age.glasser$label <- glasser_SAaxis$label
gam.smooths.glasser <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMsmoothfits.GBC.age.glasser.csv")
gam.smooths.glasser$orig_parcelname <- gam.smooths.glasser$label
gam.agepeaks.glasser <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMpeaks.GBC.age.glasser.csv")
gam.agepeaks.glasser <- gam.agepeaks.glasser %>% select(-label)
gam.agepeaks.glasser$label <- glasser.parcel.labels$label
#levels(as.factor(gam.smooths.glasser$orig_parcelname))
#gam.gbc.age.gordon <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMresults.GBC.age.gordon.csv")
#gam.gbc.age.schaefer200 <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMresults.GBC.age.schaefer200.csv")
#gam.gbc.age.schaefer400 <- read.csv("/Users/audluo/cbica/projects/network_replication/GAM/GAMresults.GBC.age.schaefer400.csv")
# Combine into Final Dfs
df.list <- list(glasser_SAaxis,gam.gbc.age.glasser)
gbc.axis <- Reduce(function(x,y) merge(x,y, all=TRUE, sort=F), df.list)
gbc.axis$SA.axis_rank <- as.numeric(gbc.axis$SA.axis_rank)
a <- merge(glasser.parcel.labels, glasser_SAaxis, by="label", sort=F)
gam.smooths.glasser <- left_join(gam.smooths.glasser, a, by = "label")
gam.smooths.glasser$SA.axis_rank <-as.numeric(gam.smooths.glasser$SA.axis_rank)
gam.agepeaks.glasser <- left_join(gam.agepeaks.glasser, glasser_SAaxis, by="label")
gam.agepeaks.glasser$SA.axis_rank <-as.numeric(gam.agepeaks.glasser$SA.axis_rank)
gbc.axis$Anova.age.pvalue.fdr <- p.adjust(gbc.axis$Anova.age.pvalue, method=c("fdr"))
cat(sprintf("There are %s/%s significant parcels", sum(gbc.axis$Anova.age.pvalue.fdr < 0.05), nrow(gbc.axis)))
gbc.axis$significant.fdr <- gbc.axis$Anova.age.pvalue.fdr < 0.05
gbc.axis$significant.fdr[gbc.axis$significant.fdr == TRUE] <- 1
gbc.axis$significant.fdr[gbc.axis$significant.fdr == FALSE] <- 0
cor.test(gbc.axis$GAM.age.AdjRsq, as.numeric(gbc.axis$SA.axis_rank), method=c("spearman"), exact=F)
gbc.axis <- gbc.axis %>% mutate(SA.axis_rank_signif = ifelse(significant.fdr == 1, SA.axis_rank, NA))
# included all datapoints
(glasser_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = signif_gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=120, y=0.05, label="R = -0.62, p < 2.2e-16 ", color="black"))
ggsave(glasser_SA.AgeEffect, file="glasser_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
ggsave(glasser_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Glasser/glasser_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
# included all datapoints
(glasser_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = signif_gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=130, y=0.05, label="R = -0.62, p < 2.2e-16 ", color="black"))
ggsave(glasser_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Glasser/glasser_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
# included all datapoints
(glasser_SA.AgeEffect <- ggplot(gbc.axis, aes(x=SA.axis_rank, y=GAM.age.AdjRsq, fill = SA.axis_rank_signif)) + geom_point(color = "white", shape = 21, size=2) +
scale_fill_gradient2(low="#6f1282",high = "goldenrod1",, mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank), na.value="gray") +
labs(fill = "SA Axis Rank", x="\nSensorimotor-Association Axis Rank\n", y=expression(paste("Age Effect (Delta Adj", " R"^2, ")"))) +
geom_smooth(data = signif_gbc.axis, method='lm', se=TRUE, fill=alpha(c("gray70"),.9), col="black") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "right") +
annotate(geom="text", x=140, y=0.05, label="R = -0.62, p < 2.2e-16 ", color="black"))
ggsave(glasser_SA.AgeEffect, file="/cbica/projects/network_replication/adapted_Rscripts/Figures/Glasser/glasser_SA.AgeEffect.pdf", width = 5, height=4, dpi=300)
# seems like transmodal areas have greater GBC and seem to increase with age, while unimodal areas have smaller GBC and increase or stays the same with age
(glasser_predGBC <- ggplot(gam.smooths.glasser,aes(age,fit,group=index)) +
geom_line(data = gam.smooths.glasser, size=.8, alpha = .6, aes(color=SA.axis_rank)) + scale_color_gradient2(low="#6f1282",high = "goldenrod1", mid = "#EBDAFF", midpoint = median(gbc.axis$SA.axis_rank)) +
labs(color = "SA Axis Rank",
x="Age",
y="Predicted Global Brain Connectivity") +
theme(
axis.title.x=element_text(size=12, color = "black"),
axis.title.y=element_text(size=12, color = "black"),
axis.line = element_line(color = "black"),
axis.text=element_text(size=12, color = "black"),
panel.background=element_blank(),
legend.position = "bottom") + coord_cartesian(expand = FALSE, xlim = c(8, 23)))
knitr::opts_chunk$set(echo = TRUE)
library(ciftiTools)
ciftiTools.setOption('wb_path', '/Applications/workbench/')
library(gifti)
library(cifti)
Sys.setenv(RGL_USE_NULL=TRUE)
library(ggseg)
library(ggsegExtra)
library(ggsegGlasser)
library(ggsegSchaefer)
library(viridis)
require(ggplot2)
library(dplyr)
schaefer200x7_commAffil <- read.csv("/Users/audluo/cbica/projects/network_replication/atlases/parcellations/Schaefer_7Network/schaefer200x7CommunityAffiliation.1D.csv")
schaefer200x7_commAffil <- read.csv("/cbica/projects/network_replication/atlases/parcellations/Schaefer_7Network/schaefer200x7CommunityAffiliation.1D.csv")
schaefer200x7_commAffil
schaefer200x7_commAffil <- read.csv("/cbica/projects/network_replication/atlases/parcellations/Schaefer_7Network/schaefer200x7CommunityAffiliation.1D.csv", header=F)
schaefer200x7_commAffil
library(cifti)
library(ciftiTools)
ciftiTools.setOption('wb_path', '/Applications/workbench/')
library(gifti)
command2 = "-cifti-parcellate /cbica/projects/network_replication/atlases/Masks/SNRmask_fslr.dscalar.nii /cbica/projects/network_replication/atlases/dlabel/Schaefer2018_400Parcels_7Networks_order.dlabel.nii COLUMN /cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x7.pscalar.nii"
ciftiTools::run_wb_cmd(command2, intern = FALSE, ignore.stdout = NULL, ignore.stderr = NULL)
command2 = "-cifti-parcellate /cbica/projects/network_replication/atlases/Masks/SNRmask_fslr.dscalar.nii /cbica/projects/network_replication/atlases/dlabel/Schaefer2018_200Parcels_7Networks_order.dlabel.nii COLUMN /cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer200x7.pscalar.nii"
ciftiTools::run_wb_cmd(command2, intern = FALSE, ignore.stdout = NULL, ignore.stderr = NULL)
SNR.mask.schaefer400x7<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x7.pscalar.nii")
SNR.mask.schaefer400x7<- as.data.frame(SNR.mask.schaefer400x7$data)
colnames(SNR.mask.schaefer400x7) <- c("SNR.mask")
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer400x7_regionlist.csv", header = T)
SNR.mask.schaefer400x7<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x7.pscalar.nii")
SNR.mask.schaefer400x7<- as.data.frame(SNR.mask.schaefer400x7$data)
colnames(SNR.mask.schaefer400x7) <- c("SNR.mask")
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer400_7Network_ggseg_regionlist.csv", header = T)
SNR.mask.schaefer400x7$label <- schaefer.parcel.labels$label
SNR.mask.schaefer400x7$SNR.mask[SNR.mask.schaefer400x7$SNR.mask <= 0.75] <- 0
SNR.mask.schaefer400x7$SNR.mask[SNR.mask.schaefer400x7$SNR.mask > 0.75] <- 1
sum(SNR.mask.schaefer400x7$SNR.mask == 0) #24 schaefer400 parcels removed from analysis
#write.csv(SNR.mask.schaefer400x7, "/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer400x7.csv", quote = F, row.names = F)
SNR.mask.schaefer400x7
SNR.mask.schaefer400x17<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x17.pscalar.nii")
SNR.mask.schaefer400x17<- as.data.frame(SNR.mask.schaefer400x17$data)
colnames(SNR.mask.schaefer400x17) <- c("SNR.mask")
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer400x17_regionlist.csv", header = T)
SNR.mask.schaefer400x17$label <- schaefer.parcel.labels$label
SNR.mask.schaefer400x17$SNR.mask[SNR.mask.schaefer400x17$SNR.mask <= 0.75] <- 0
SNR.mask.schaefer400x17$SNR.mask[SNR.mask.schaefer400x17$SNR.mask > 0.75] <- 1
sum(SNR.mask.schaefer400x17$SNR.mask == 0) #24 schaefer400 parcels removed from analysis
#write.csv(SNR.mask.schaefer400x17, "/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer400x17.csv", quote = F, row.names = F)
#write.csv(SNR.mask.schaefer400x17, "/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer400x17.csv", quote = F, row.names = F)
identical(SNR.mask.schaefer400x17, SNR.mask.schaefer400x7)
#write.csv(SNR.mask.schaefer400x17, "/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer400x17.csv", quote = F, row.names = F)
cbind(SNR.mask.schaefer400x17, SNR.mask.schaefer400x7)
SNR.mask.schaefer400x17<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x17.pscalar.nii")
SNR.mask.schaefer400x7<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x7.pscalar.nii")
SNR.mask.schaefer400x17
SNR.mask.schaefer400x17$Surface
SNR.mask.schaefer400x17$data
identical(SNR.mask.schaefer400x17$data. SNR.mask.schaefer400x7$data)
identical(SNR.mask.schaefer400x17$data, SNR.mask.schaefer400x7$data)
setdiff(SNR.mask.schaefer400x17$data, SNR.mask.schaefer400x7$data)
intersect(SNR.mask.schaefer400x17$data, SNR.mask.schaefer400x7$data)
SNR.mask.schaefer400x7<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer400x7.pscalar.nii")
SNR.mask.schaefer400x7<- as.data.frame(SNR.mask.schaefer400x7$data)
colnames(SNR.mask.schaefer400x7) <- c("SNR.mask")
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer400_7Network_ggseg_regionlist.csv", header = T)
SNR.mask.schaefer400x7$label <- schaefer.parcel.labels$label
SNR.mask.schaefer400x7$SNR.mask[SNR.mask.schaefer400x7$SNR.mask <= 0.75] <- 0
SNR.mask.schaefer400x7$SNR.mask[SNR.mask.schaefer400x7$SNR.mask > 0.75] <- 1
sum(SNR.mask.schaefer400x7$SNR.mask == 0) #24 schaefer400 parcels removed from analysis
SNR.mask.schaefer200x7<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer200x7.pscalar.nii")
SNR.mask.schaefer200x7<- as.data.frame(SNR.mask.schaefer200x7$data)
colnames(SNR.mask.schaefer200x7) <- c("SNR.mask")
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200_7Network_ggseg_regionlist", header = T)
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200_7Network_ggseg_regionlist.csv", header = T)
schaefer.parcel.labels
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer400_7Network_ggseg_regionlist.csv", header = T)
schaefer.parcel.labels
SNR.mask.schaefer200x7<- cifti::read_cifti("/cbica/projects/network_replication/atlases/parcellations/surface/SNRmask_schaefer200x7.pscalar.nii")
SNR.mask.schaefer200x7<- as.data.frame(SNR.mask.schaefer200x7$data)
colnames(SNR.mask.schaefer200x7) <- c("SNR.mask")
schaefer.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200_7Network_ggseg_regionlist.csv", header = T)
SNR.mask.schaefer200x7$label <- schaefer.parcel.labels$label
SNR.mask.schaefer200x7$SNR.mask[SNR.mask.schaefer200x7$SNR.mask <= 0.75] <- 0
SNR.mask.schaefer200x7$SNR.mask[SNR.mask.schaefer200x7$SNR.mask > 0.75] <- 1
sum(SNR.mask.schaefer200x7$SNR.mask == 0) #11 schaefer200 parcels removed from analysis
sum(SNR.mask.schaefer400x7$SNR.mask == 0) #24 schaefer400 parcels removed from analysis
write.csv(SNR.mask.schaefer400x7, "/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer400x7.csv", quote = F, row.names = F)
write.csv(SNR.mask.schaefer200x7, "/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer200x7.csv", quote = F, row.names = F)
SNRmask_schaefer200 <- read.csv('/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer200x7.csv')
knitr::opts_chunk$set(echo = TRUE)
library(ciftiTools)
ciftiTools.setOption('wb_path', '/Applications/workbench/')
library(gifti)
library(cifti)
Sys.setenv(RGL_USE_NULL=TRUE)
library(ggseg)
library(ggsegExtra)
library(ggsegGlasser)
library(ggsegSchaefer)
library(viridis)
require(ggplot2)
library(dplyr)
test <- read.csv("/Users/audluo/cbica/projects/network_replication/atlases/parcellations/Schaefer_17Network/schaefer200x17NodeNames.csv", header=F)
schaefer200.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200x17_regionlist.csv", header = T)
schaefer200.parcel.labels
schaefer200.parcel.labels
test
test1 <- gsub("17Networks_", "", schaefer200.parcel.labels$x)
identical(test, test1)
test1
test
identical(test$V1, test1)
setdiff(test$V1, test1)
test
cbind(test$V1, test1)
schaefer200.parcel.labels <- read.csv("/cbica/projects/network_replication/atlases/parcellations/schaefer200x17_regionlist.csv", header = T)
names(schaefer200.parcel.labels)[2] <- "label"
schaefer200.parcel.labels$labels
schaefer200.parcel.labels$label
schaefer200.parcel.labels
SNRmask_schaefer200 <- read.csv('/cbica/projects/network_replication/atlases/Masks/SNRmask_schaefer200x17.csv')
schaefer200x7_commAffil
matric(schaefer200x7_commAffil, nrow =200, ncol=200)
matrix(schaefer200x7_commAffil, nrow =200, ncol=200)
schaefer200x7_commAffil
install.packages('igraph')
library(igraph)
cbind(read.table(text = names(schaefer200x7_commAffil)), schaefer200x7_commAffil) %>%
graph_from_data_frame(directed = FALSE) %>%
get.adjacency(attr = "schaefer200x7_commAffil", sparse = FALSE)
cbind(read.table(tschaefer200x7_commAffil) %>%
knitr::opts_chunk$set(echo = TRUE)
library(ciftiTools)
onnect.matrix <- read_cifti(sprintf("/cbica/projects/network_replication/pconn/%1$s/%1$s_ses-PNC1_task-rest_acq-singleband_space-fsLR_atlas-Schaefer217_den-91k_den-91k_bold.pconn.nii",rbcid))
connect.matrix <- read_cifti(sprintf("/cbica/projects/network_replication/pconn/sub-997818717/sub-997818717_ses-PNC1_task-rest_acq-singleband_space-fsLR_atlas-Schaefer217_den-91k_den-91k_bold.pconn.nii",rbcid))
connect.matrix <- read_cifti(sprintf("/cbica/projects/network_replication/pconn/sub-997818717/sub-997818717_ses-PNC1_task-rest_acq-singleband_space-fsLR_atlas-Schaefer217_den-91k_den-91k_bold.pconn.nii"))
